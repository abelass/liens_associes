<div class='formulaire_spip formulaire_editer formulaire_#FORM formulaire_#FORM-#ENV{id_associe_lien,nouveau}'>
	[<p class="reponse_formulaire reponse_formulaire_ok">(#ENV**{message_ok})</p>]
	[<p class="reponse_formulaire reponse_formulaire_erreur">(#ENV*{message_erreur})</p>]
	[(#ENV{editable})
	<form method="post" action="#ENV{action}"><div>
		#ACTION_FORMULAIRE{#ENV{action}}
		<input type="hidden" name="id_associe_lien" value="#ENV{id_associe_lien}" />
		<div class="editer-groupe">

			[(#SAISIE{oui_non, lien_interne,
				label=<:associe_lien:champ_lien_interne_label:>,
				explication=<:associe_lien:champ_lien_interne_explication:> })]

			[(#SAISIE{choisir_objet, objet,
				label=<:associe_lien:champ_objet_label:>,
				explication=<:associe_lien:champ_objet_explication:> })]

			<INCLURE{fond=formulaires/inc-editer_associe_lien_champ_objet,ajax=champ_objet,env}/>

			[(#SAISIE{input, titre, obligatoire=oui,
				label=<:associe_lien:champ_titre_label:>})]


			[(#SAISIE{input, url,
				label=<:associe_lien:champ_url_label:>})]

			[(#SAISIE{textarea, descriptif,
				label=<:associe_lien:champ_descriptif_label:>,
				conteneur_class=pleine_largeur, class=inserer_barre_edition, rows=4})]

		</div>
		[(#REM) ajouter les saisies supplementaires : extra et autre, a cet endroit ]
		<!--extra-->
		<p class="boutons"><input type="submit" class="submit" value="<:bouton_enregistrer:>" /></p>
	</div></form>
	]
</div>

<script type="text/javascript">

	// Show hide fields
	if($('input:radio[name="lien_interne"]:checked', '.formulaire_editer_associe_lien').val() == 'on') {

		hide_field([".editer_url"]);
		show_field([".editer_objet"]);
	}
	else {
		hide_field([".editer_objet"]);
		show_field([".editer_url"]);
	}

	if($("select#champ_objet").val() != '') {
		show_field([".editer_id_objet"]);

	}
	else {
		hide_field([".editer_id_objet"]);
	}


	// Chagement du type de lien.
	$('input:radio[name="lien_interne"]', '.formulaire_editer_associe_lien').change(
		function(){
				if ($(this).val() == '') {
					hide_field([".editer_objet",".editer_id_objet"]);
					show_field([".editer_url"]);
				}
				else {
					hide_field([".editer_url"]);
					show_field([".editer_objet"]);
				}
		}
	);

	// Changement de l'objet.
	$('select[name="objet"]', '.formulaire_editer_associe_lien').change(
			function(){
				if ($(this).val() != '') {
					show_field([".editer_id_objet"]);
					// Reload le squellette pour que le autocimplete aie le bone objet.
					ajaxReload('champ_objet', {
						args:{
							objet:$(this).val(),
							lien_interne: 'on'
						},
					});
				}
				else {
					hide_field([".editer_id_objet"]);
				}
			}
		);

	function hide_field(fields, speed){
		speed = speed || 800;

		jQuery.each(fields, function(index, field) {
			$(field).hide(speed);
			$(field +' input').removeAttr('required');
			$(field + ' > label span').replaceWith('');
			$(field).removeClass('obligatoire');
		});
	}

	function show_field(fields, speed){
		speed = speed || 800;
		jQuery.each(fields, function(index, field) {
			$(field).show(speed);
			$(field +' input').prop('required','true');
			$(field + ' > label span').replaceWith('');
			$(field + ' > label').append('<span class="obligatoire"> <:info_obligatoire_02:></span>');
			$(field).addClass('obligatoire');
		});
	}

</script>
